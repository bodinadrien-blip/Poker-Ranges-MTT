<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Poker Ranges MTT Pro</title>

<!-- iOS PWA -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Poker Ranges">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="manifest" href="manifest.json">

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root{
  --panel:#141820;
  --border:#1f2633;
  --open:#2ecc71;
  --call:#1e88e5;
  --bet3:#ff9800;
  --allin:#e53935;
  --fold:#2a2f3a;
  --text:#fff;
  --muted:#8a93a3;
}

body{
  margin:0;
  background:radial-gradient(circle at top,#121621,#07090c);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,Arial;
}

header{
  padding:14px;
  text-align:center;
  font-weight:800;
  letter-spacing:1px;
  background:linear-gradient(180deg,#111520,#0a0c11);
  border-bottom:1px solid var(--border);
}

.container{padding:12px}

select,button{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--panel);
  color:var(--text);
  font-size:15px;
  font-weight:600;
}

.buttons{
  display:flex;
  gap:8px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(13,1fr);
  gap:2px;
}

.cell{
  aspect-ratio:1/1;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:clamp(14px,3.5vw,26px);
  border-radius:8px;
  font-weight:700;
  user-select:none;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.06);
}

.open{background:linear-gradient(135deg,#1e824c,var(--open))}
.call{background:linear-gradient(135deg,#1565c0,var(--call))}
.bet3{background:linear-gradient(135deg,#ff6f00,var(--bet3));color:#000}
.allin{background:linear-gradient(135deg,#b71c1c,var(--allin))}
.fold{background:var(--fold);color:var(--muted)}

.legend{
  display:flex;
  justify-content:space-between;
  font-size:12px;
  margin:8px 0;
  color:var(--muted);
}
.legend div{display:flex;align-items:center;gap:4px}
.box{width:12px;height:12px;border-radius:3px}

#percent{
  text-align:center;
  font-weight:700;
  margin:8px 0;
}

.coach-on .cell{
  pointer-events:none;
  filter:brightness(.9);
}
</style>
</head>

<body>
<header>‚ô†Ô∏è POKER RANGES ‚Äî MTT PRO</header>

<div class="container">

<select id="spot">
  <option>UTG</option><option>HJ</option><option>CO</option>
  <option>BTN</option><option>SB</option><option>BB</option>
</select>

<select id="action">
  <option value="open">Open</option>
  <option value="call">Open 3bet</option>
  <option value="bet3">Call</option>
  <option value="bet3">Rase</option>
  <option value="allin">All-in</option>
  <option value="fold">Fold</option>
</select>

<select id="stack"></select>

<div class="buttons">
  <button id="coachToggle">üß† Coach : OFF</button>
  <button onclick="exportImage()">üì§ Image</button>
</div>

<div class="buttons">
  <button onclick="exportJSON()">üíæ Export JSON</button>
  <button onclick="importJSON()">üìÇ Import JSON</button>
</div>

<div id="percent">Range : 0%</div>

<div class="legend">
  <div><div class="box open"></div>Open</div>
  <div><div class="box call"></div>Open 3bet</div>
  <div><div class="box call"></div>Call</div>
  <div><div class="box bet3"></div>Rase</div>
  <div><div class="box allin"></div>All-in</div>
  <div><div class="box fold"></div>Fold</div>
</div>

<div id="grid" class="grid"></div>
</div>

<script>
const ranks=["A","K","Q","J","T","9","8","7","6","5","4","3","2"];
const grid=document.getElementById("grid");
const stack=document.getElementById("stack");
const percent=document.getElementById("percent");
let coachMode=false;

const stackOptions={
  UTG:{open:["D√©but mtt","Milieu mtt","Fin mtt"],open 3bet:["12>30bb","30>50bb","500bb+"],call:["2bb"],rase:["2bb+"],allin:["12bb","8bb"]},
  HJ:{open:["20bb x2","30bb x2.5","45bb x3"],call:["Standard"],bet3:["Mix"],allin:["‚â§10bb"],fold:["‚Äî"]},
  CO:{open:["20bb x2","30bb x2.5","45bb x3"],call:["Large"],bet3:["Value","Light"],allin:["‚â§12bb"],fold:["‚Äî"]},
  BTN:{open:["20bb x2","30bb x2.5","45bb x3"],call:["Tr√®s large"],bet3:["Aggro","Light"],allin:["‚â§15bb"],fold:["‚Äî"]},
  SB:{open:["D√©but x3.5","Milieu x2.5","Fin x2.1"],call:["Rare"],bet3:["Polaris√©"],allin:["‚â§12bb"],fold:["‚Äî"]},
  BB:{open:["D√©but x3.5","Milieu x2.5","Fin x2.1"],call:["Tr√®s large"],bet3:["Value","Light"],allin:["‚â§15bb"],fold:["‚Äî"]}
};

function updateStack(){
  stack.innerHTML="";
  stackOptions[spot.value][action.value].forEach(v=>{
    const o=document.createElement("option");
    o.value=v;
    o.textContent=v;
    stack.appendChild(o);
  });
}

function key(){
  return `range_${spot.value}_${action.value}_${stack.value}`;
}

function build(){
  grid.innerHTML="";
  const saved=JSON.parse(localStorage.getItem(key())||"{}");

  ranks.forEach((r,i)=>ranks.forEach((c,j)=>{
    const h=i===j?r+r:i<j?r+c+"s":c+r+"o";
    const d=document.createElement("div");
    d.className="cell "+(saved[h]||"fold");
    d.textContent=h;

    d.onclick=()=>{
      if(coachMode) return;

      if(saved[h]){
        delete saved[h];
        d.className="cell fold";
      }else{
        saved[h]=action.value;
        d.className="cell "+action.value;
      }

      localStorage.setItem(key(),JSON.stringify(saved));
      updatePercent();
    };
    grid.appendChild(d);
  }));
  updatePercent();
}

function updatePercent(){
  const a=[...document.querySelectorAll('.cell')].filter(c=>!c.classList.contains("fold")).length;
  percent.textContent=`${spot.value} ¬∑ ${action.value} ¬∑ ${stack.value} : ${(a/169*100).toFixed(1)}%`;
}

document.getElementById("coachToggle").onclick=()=>{
  coachMode=!coachMode;
  document.body.classList.toggle("coach-on",coachMode);
  coachToggle.textContent=coachMode?"üß† Coach : ON":"üß† Coach : OFF";
};

function exportImage(){
  html2canvas(grid).then(c=>{
    const a=document.createElement("a");
    a.href=c.toDataURL();
    a.download=key()+".png";
    a.click();
  });
}

function exportJSON(){
  const data={};
  Object.keys(localStorage).filter(k=>k.startsWith("range_"))
    .forEach(k=>data[k]=JSON.parse(localStorage.getItem(k)));
  const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="ranges_backup.json";
  a.click();
}

function importJSON(){
  const i=document.createElement("input");
  i.type="file";
  i.accept="application/json";
  i.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{
      const d=JSON.parse(r.result);
      Object.keys(d).forEach(k=>localStorage.setItem(k,JSON.stringify(d[k])));
      build();
      alert("‚úÖ Import termin√©");
    };
    r.readAsText(e.target.files[0]);
  };
  i.click();
}

spot.onchange=action.onchange=()=>{updateStack();build();};
stack.onchange=build;

updateStack();
build();
</script>
</body>
</html>