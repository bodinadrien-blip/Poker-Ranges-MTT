
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Poker Ranges MTT Pro</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root{
  --panel:#141820;
  --border:#1f2633;
  --text:#fff;
  --muted:#8a93a3;

  /* NOUVELLES COULEURS POSITIONS */
  --utg:#2ecc71;     /* vert */
  --utg1:#1B4332;    /* vert fonc√© */
  --hj:#9b59b6;      /* violet */
  --co:#3498db;      /* bleu */
  --btn:#f39c12;     /* orange */
  --sb:#e74c3c;      /* rouge */
  --bb:#c0392b;      /* rouge fonc√© */

  --fold:#2a2f3a;
  --info:#7aa2ff;
  --info-active:#2ecc71;
}

body{
  margin:0;
  background:radial-gradient(circle at top,#121621,#07090c);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,Arial;
}

header{
  padding:14px;
  text-align:center;
  font-weight:800;
  background:#0a0c11;
  border-bottom:1px solid var(--border);
}

.container{padding:12px}

select,button{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--panel);
  color:var(--text);
  font-size:15px;
  font-weight:600;
}

.buttons{display:flex;gap:8px}

/* ===== MOBILE FIRST (sans scroll) ===== */
.grid{
  display:grid;
  grid-template-columns:repeat(13, 1fr);
  gap:2px;
  width:100%;
}

.cell{
  aspect-ratio:1/1;
  font-size:clamp(10px, 2.6vw, 14px);
}

/* ===== TABLET / DESKTOP ===== */
@media (min-width: 768px){
  .grid{
    grid-template-columns:repeat(13, 52px);
    width:calc(13 * 52px + 24px);
    margin:0 auto;
  }

  .cell{
    font-size:16px;
  }
}

/* ===== LARGE DESKTOP ===== */
@media (min-width: 1200px){
  .grid{
    grid-template-columns:repeat(13, 60px);
    width:calc(13 * 60px + 24px);
  }

  .cell{
    font-size:18px;
  }
}


.fold{background:var(--fold);color:var(--muted)}
.utg{background:var(--utg)}
.utg1{background:var(--utg1)}
.hj{background:var(--hj)}
.co{background:var(--co)}
.btn{background:var(--btn);color:#000}
.sb{background:var(--sb)}
.bb{background:var(--bb)}

.legend{
  display:flex;
  justify-content:space-between;
  font-size:12px;
  margin:8px 0 12px;
  color:var(--muted);
}
.legend div{
  display:flex;
  align-items:center;
  gap:4px;
}
.box{
  width:12px;
  height:12px;
  border-radius:3px;
}

#percent{
  text-align:center;
  font-weight:700;
  margin:8px 0;
}

.coach-on .cell{
  pointer-events:none;
  filter:brightness(.9);
}

/* NOTES */
#infoBtn{
  cursor:pointer;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0e1220;
  color:var(--info);
}

#infoBtn.active{
  color:var(--info-active);
  border-color:var(--info-active);
}

.info-bubble{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
  margin-bottom:10px;
}

.info-bubble textarea{
  width:100%;
  min-height:90px;
  background:#0e1220;
  color:#fff;
  border:1px solid var(--border);
  border-radius:8px;
  padding:8px;
}

.hidden{display:none}

.export-zone{
  background:#07090c;
  padding:12px;
  border-radius:12px;
}

.export-notes{
  font-size:12px;
  line-height:1.4;
  color:#d0d6e0;
  background:#0e1220;
  border:1px solid var(--border);
  border-radius:8px;
  padding:8px;
  margin-bottom:10px;
  white-space:pre-wrap;
}

@media (min-width:768px){
  .export-notes{font-size:13px}
}

.cell{
  transition:transform .05s ease,filter .05s ease;
}
.cell:hover{
  transform:scale(1.08);
  filter:brightness(1.15);
  z-index:2;
}

</style>
</head>

<body>

<header>‚ô†Ô∏è POKER RANGES ‚Äî MTT PRO</header>

<div class="container">

<select id="action">
  <option value="open">Open</option>
  <option value="open3bet">Open 3bet</option>
  <option value="call">Call</option>
  <option value="raise">Raise</option>
  <option value="allin">All-in</option>
</select>

<select id="position">
  <option value="utg">UTG</option>
  <option value="utg1">UTG+1</option>
  <option value="hj">HJ</option>
  <option value="co">CO</option>
  <option value="btn">BTN</option>
  <option value="sb">SB</option>
  <option value="bb">BB</option>
</select>

<select id="stack"></select>

<button id="infoBtn">‚ìò Notes pour cette action</button>

<div id="infoBubble" class="info-bubble hidden">
  <textarea id="infoText" placeholder="Notes strat√©giques, exploits, reads‚Ä¶"></textarea>
  <button id="saveInfo">üíæ Sauvegarder la note</button>
</div>


<div class="grid-wrapper export-zone">

  <!-- L√âGENDE -->
  <div class="legend">
    <div><div class="box utg"></div>UTG</div>
    <div><div class="box utg1"></div>UTG+1</div>
    <div><div class="box hj"></div>HJ</div>
    <div><div class="box co"></div>CO</div>
    <div><div class="box btn"></div>BTN</div>
    <div><div class="box sb"></div>SB</div>
    <div><div class="box bb"></div>BB</div>
  </div>

  <div id="exportNotes" class="export-notes hidden"></div>

  
  <!-- GRID -->
  <div id="grid" class="grid"></div>

</div>

<div id="stats" style="text-align:center;margin-top:8px;font-weight:700;"></div>

<div class="buttons">
  <button id="coachToggle">üß† Coach : ON</button>
  <button id="viewMode">üëÅÔ∏è Range Viewer : OFF</button>
  <button onclick="exportImage()">üì§ Image</button>
</div>

<div class="buttons">
  <button onclick="exportAll()">üíæ Export ranges + notes</button>
  <button onclick="importAll()">üìÇ Import ranges + notes</button>
</div>

<script>
/* JS IDENTIQUE √Ä LA VERSION PR√âC√âDENTE ‚Äì NON MODIFI√â */
const ranks=["A","K","Q","J","T","9","8","7","6","5","4","3","2"];
const grid=document.getElementById("grid");
const stack=document.getElementById("stack");
const percent=document.getElementById("percent");
const action=document.getElementById("action");
const position=document.getElementById("position");
const coachToggle=document.getElementById("coachToggle");

let coachMode=true;

const ACTIONS={
  open:["Debut mtt","Milieu mtt","Fin mtt"],
  open3bet:["10>30bb","30>50bb","+50bb"],
  call:["2bb","2bb+"],
  raise:["2bb"],
  allin:["+25bb","‚â§15bb","‚â§12bb","‚â§8bb"]
};

function updateStack(){
  stack.innerHTML="";
  ACTIONS[action.value].forEach(v=>{
    const o=document.createElement("option");
    o.textContent=v;
    stack.appendChild(o);
  });
}

function rangeKey(){
  return `range_${action.value}_${stack.value}`;
}

function build(){
  grid.innerHTML="";
  const saved=JSON.parse(localStorage.getItem(rangeKey())||"{}");

  ranks.forEach((r,i)=>ranks.forEach((c,j)=>{
    const h=i===j?r+r:i<j?r+c+"s":c+r+"o";
    const d=document.createElement("div");
    d.className="cell "+(saved[h]?.pos||"fold");
    d.textContent=h;

    d.onclick=()=>{
      if(coachMode) return;
      if(saved[h]){delete saved[h];d.className="cell fold";}
      else{saved[h]={pos:position.value};d.className="cell "+position.value;}
      localStorage.setItem(rangeKey(),JSON.stringify(saved));
      updatePercent();
    };
    grid.appendChild(d);
  }));
  updatePercent();
}

function updatePercent(){
  const a=[...document.querySelectorAll('.cell')].filter(c=>!c.classList.contains("fold")).length;
  percent.textContent=`${action.value.toUpperCase()} ¬∑ ${position.value.toUpperCase()} ¬∑ ${stack.value} : ${(a/169*100).toFixed(1)}%`;
}

coachToggle.onclick=()=>{
  coachMode=!coachMode;
  document.body.classList.toggle("coach-on",coachMode);
  coachToggle.textContent=coachMode?"üß† Coach : ON":"üß† Coach : OFF";
};

function exportImage(){
  const wrapper = document.querySelector('.export-zone');
  const notesBox = document.getElementById("exportNotes");

  const noteKey = `info_${action.value}`;
  const note = localStorage.getItem(noteKey);

  if(note){
    notesBox.textContent = "üìù NOTES ‚Äî " + action.value.toUpperCase() + "\n" + note;
    notesBox.classList.remove("hidden");
  }

  const fileName = [
    action.value.toUpperCase(),
    stack.value.replace(/\s+/g,'-')
  ].join("_");

  html2canvas(wrapper, {
    scale:2,
    backgroundColor:"#07090c"
  }).then(c=>{
    const a=document.createElement("a");
    a.href=c.toDataURL("image/png");
    a.download=fileName + ".png";
    a.click();

    // üîÅ on cache √† nouveau apr√®s export
    notesBox.classList.add("hidden");
    notesBox.textContent="";
  });
}




/* NOTES */
const infoBtn=document.getElementById("infoBtn");
const infoBubble=document.getElementById("infoBubble");
const infoText=document.getElementById("infoText");
const saveInfo=document.getElementById("saveInfo");

function infoKey(){
  return `info_${action.value}_${stack.value.replace(/\s+/g,'_')}`;
}

function refreshInfoBtn(){
  infoBtn.classList.toggle("active",!!localStorage.getItem(infoKey()));
}

infoBtn.onclick=()=>{
  infoBubble.classList.toggle("hidden");
  infoText.value=localStorage.getItem(infoKey())||"";
};

saveInfo.onclick=()=>{
  localStorage.setItem(infoKey(),infoText.value.trim());
  infoBubble.classList.add("hidden");
  refreshInfoBtn();
};

function exportAll(){
  const data={ranges:{},notes:{}};
  Object.keys(localStorage).forEach(k=>{
    if(k.startsWith("range_")) data.ranges[k]=JSON.parse(localStorage.getItem(k));
    if(k.startsWith("info_")) data.notes[k]=localStorage.getItem(k);
  });
  const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="ranges_notes_backup.json";
  a.click();
}

function importAll(){
  const i=document.createElement("input");
  i.type="file";
  i.accept="application/json";
  i.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{
      const d=JSON.parse(r.result);
      Object.entries(d.ranges||{}).forEach(([k,v])=>localStorage.setItem(k,JSON.stringify(v)));
      Object.entries(d.notes||{}).forEach(([k,v])=>localStorage.setItem(k,v));
      build();refreshInfoBtn();
      alert("‚úÖ Ranges + notes import√©es");
    };
    r.readAsText(e.target.files[0]);
  };
  i.click();
}

let viewMode=false;

document.getElementById("viewMode").onclick=()=>{
  viewMode=!viewMode;
  document.getElementById("viewMode").textContent =
    viewMode ? "‚úèÔ∏è Edit Mode" : "üëÅÔ∏è Range Viewer";
  viewMode ? buildView() : build();
};

function buildView(){
  grid.innerHTML="";

  const merged = {};
  const idx = POS_ORDER.indexOf(position.value);
  const allowed = POS_ORDER.slice(0, idx + 1);

  Object.keys(localStorage).forEach(k=>{
    if(!k.startsWith("range_")) return;

    const data = JSON.parse(localStorage.getItem(k) || "{}");

    Object.entries(data).forEach(([hand,val])=>{
      if(val && allowed.includes(val.pos)){
        merged[hand] = val.pos;
      }
    });
  });

  ranks.forEach((r,i)=>ranks.forEach((c,j)=>{
    const h = i===j ? r+r : i<j ? r+c+"s" : c+r+"o";

    const d = document.createElement("div");
    d.className = "cell " + (merged[h] || "fold");
    d.textContent = h;

    grid.appendChild(d);
  }));

  updateStats(merged);
}

function updateStats(obj){
  const n = Object.keys(obj).length;
  const p = (n/169*100).toFixed(1);
  document.getElementById("stats").textContent =
    `Range global ${position.value.toUpperCase()} : ${p}% (${n} combos)`;
  const POS_ORDER = ["utg","utg1","hj","co","btn","sb","bb"];
}

action.onchange=()=>{updateStack();build();refreshInfoBtn();};
position.onchange=build;
stack.onchange=build;

updateStack();
build();
refreshInfoBtn();
</script>

</body>
</html>
